-- 장바구니 DB 정리 (2020.10.14, 정경채)

-- 제품 테이블 생성
create table wmk_goods (
    gdsNum       number          not null,
    gdsName      varchar2(50)    not null,
    cateCode     varchar2(30)    not null,
    gdsPrice     number          not null,
    gdsStock     number          null,
    gdsDes       varchar(500)    null,
    gdsImg       varchar(200)    null,
    gdsDate      date            default sysdate,
    primary key(gdsNum)  
);

create sequence wmk_goods_seq;


--제품 등록

insert into wmk_goods (gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg) 
values (wmk_goods_seq.nextval, 'Picture frame', 101, 30000, 50, '나만의 홈인테리어를 꾸며줄 작은 데코레이션', 'goods/picture_frame.png');

insert into wmk_goods (gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg) 
values (wmk_goods_seq.nextval, 'T-shirts', 201, 15000, 50, '스타일과 편안함을 모두 갖춘 프리미엄 원단 100% 티셔츠', 'goods/t-shirts.png');

insert into wmk_goods (gdsNum, gdsName, cateCode, gdsPrice, gdsStock, gdsDes, gdsImg) 
values (wmk_goods_seq.nextval, 'Mug-cup', 301, 8000, 50, '모던하고 세련된 스타일의 나만을 위한 시그니처 아이템', 'goods/mug_cup.png');

--제품 카테고리 생성
create table goods_category (
    cateName varchar2(20) not null,
    cateCode varchar2(30) not null,
    cateCodeRef varchar(30) null,
    primary key(cateCode),
    foreign key(cateCodeRef) references goods_category(cateCode)
);


--제품 카테고리 등록

insert into goods_category (cateName, cateCode) values ('액자', '100');
insert into goods_category (cateName, cateCode, cateCodeRef) values ('액자1-1', '101', '100');

insert into goods_category (cateName, cateCode) values ('티셔츠', '200');
insert into goods_category (cateName, cateCode, cateCodeRef) values ('티셔츠1-1', '201', '200');
insert into goods_category (cateName, cateCode, cateCodeRef) values ('티셔츠1-2', '202', '200');

insert into goods_category (cateName, cateCode) values ('머그컵', '300');
insert into goods_category (cateName, cateCode, cateCodeRef) values ('머그컵1-1', '301', '300');

--제품 카테고리 조회
select level, cateName, cateCode, cateCodeRef from goods_category
    start with cateCodeRef is null connect by prior cateCode = cateCodeRef;
    

--장바구니 생성
create table wmk_cart (
    cartNum     number          not null,
    userId      varchar2(50)    not null,
    gdsNum      number          not null,
    gdsColor    varchar2(50)    null,
    gdsSize     varchar2(50)    null,
    gdsText     varchar2(50)    null,
    cartStock   number          not null,
    addDate     date            default sysdate,
    primary key(cartNum, userId) 
);

create sequence wmk_cart_seq;

--우리 계정 아이디를 장바구니 에서 외래키로 받기
alter table wmk_cart
    add constraint wmk_cart_userId foreign key(userId)
    references wmk_users(ID);

--상품 번호를 장바구니에서 외래키로 받기
alter table wmk_cart
    add constraint wmk_cart_gdsNum foreign key(gdsNum)
    references wmk_goods(gdsNum);

--특정 회원의 장바구니 조회하기
select
    row_number() over(order by c.cartNum desc) as num,
    c.cartNum, c.userId, c.gdsNum, c.cartStock, c.addDate, c.gdsColor, c.gdsSize, c.gdsText,
    g.gdsName, g.gdsPrice, g.gdsimg
from wmk_cart c
    inner join wmk_goods g
        on c.gdsNum = g.gdsNum
    where c.userId = 'abcde';
    
    
commit;